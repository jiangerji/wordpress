<?phpclass EnhancedTextWidget extends WP_Widget {    /**     * Widget construction     */    function __construct() {        $widget_ops = array('classname' => 'widget_text enhanced-text-widget', 'description' => __('支持添加任意HTML、Javascript、PHP代码', 'enhancedtext'));        $control_ops = array('width' => 400, 'height' => 350);        parent::__construct('EnhancedTextWidget', __('PCKr 广告模块', 'enhancedtext'), $widget_ops, $control_ops);    }    /**     * Setup the widget output     */    function widget( $args, $instance ) {        if (!isset($args['widget_id'])) {          $args['widget_id'] = null;        }        extract($args);        $text = apply_filters('widget_enhanced_text', $instance['text'], $instance);        echo $bare ? '' : '<section class="sidebar-ad">';        // Parse the text through PHP        ob_start();        eval('?>' . $text);        $text = ob_get_contents();        ob_end_clean();        // Run text through do_shortcode        $text = do_shortcode($text);        // Echo the content        echo $filterText ? wpautop($text) : $text;        echo $bare ? '' : '</section>' . $after_widget;    }    /**     * Run on widget update     */    function update( $new_instance, $old_instance ) {        $instance = $old_instance;        $instance['title'] = strip_tags($new_instance['title']);        if ( current_user_can('unfiltered_html') )            $instance['text'] =  $new_instance['text'];        else        $instance['cssClass'] = strip_tags($new_instance['cssClass']);        return $instance;    }    /**     * Setup the widget admin form     */    function form( $instance ) {        $instance = wp_parse_args( (array) $instance, array(            'text' => ''        ));        $text = format_to_edit($instance['text']);?>        <style>            .monospace { font-family: Consolas, Lucida Console, monospace; }        </style>        <p>            <label for="<?php echo $this->get_field_id('text'); ?>"><?php _e('广告代码', 'enhancedtext'); ?>:</label>            <textarea class="widefat monospace" rows="16" cols="20" id="<?php echo $this->get_field_id('text'); ?>" name="<?php echo $this->get_field_name('text'); ?>"><?php echo $text; ?></textarea>        </p>        <p class="credits"><small>基于 <a href="http://pomelodesign.com" rel="nofollow">Pomelo Design</a> EnhancedTextWidget 修改</small></p>		<p class="credits"><small>常用广告代码：<code><?php echo htmlspecialchars('<a href="链接地址" target="_blank"><img src="图片地址" alt="ads" /></a>'); ?></code></small></p><?php    }}/** * Register the widget */function enhanced_text_widget_init() {    register_widget('EnhancedTextWidget');}add_action('widgets_init', 'enhanced_text_widget_init');