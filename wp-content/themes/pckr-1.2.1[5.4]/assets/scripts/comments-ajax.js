var edit_mode="0",ajax_php_url=ajax_url+"/lib/comments-ajax.php",pic_sb=ajax_url+"/assets/images/loading.gif",pic_no=ajax_url+"/assets/images/error.png",pic_ys=ajax_url+"/assets/images/yes.png",txt1='<div id="loading"><img src="'+pic_sb+'" style="vertical-align:middle;" alt=""/> 正在提交, 请稍候...</div>',txt2='<div id="loading"><div id="error">#</div></div>',txt3='"><img src="'+pic_ys+'" style="vertical-align:middle;margin-bottom: 3px;" alt=""/> 提交成功',edt1='， 刷新页面之前可以<a rel="nofollow" class="comment-reply-link" href="#edit" onclick=\'return addComment.moveForm("',edt2=")'>再编辑</a>",cancel_edit="取消编辑",edit,num=1,comm_array=[];comm_array.push("");jQuery(document).ready(function(B){$comments=B("#comments-title");$cancel=B("#cancel-comment-reply-link");cancel_text=$cancel.text();$submit=B("#commentform #submit");$submit.attr("disabled",false);B("#author-textarea").after(txt1+txt2);B("#loading").hide();B("#error").hide();$body=(window.opera)?(document.compatMode=="CSS1Compat"?B("html"):B("body")):B("html,body");B("#comment-form").submit(function(){B("#loading").slideDown();$submit.attr("disabled",true).fadeTo("slow",0.5);if(edit){B("#comment").after('<input type="text" name="edit_id" id="edit_id" value="'+edit+'" style="display:none;" />')}B.ajax({url:ajax_php_url,data:B(this).serialize(),type:B(this).attr("method"),error:function(F){B("#loading").slideUp();B("#error").slideDown().html('<img src="'+pic_no+'" style="vertical-align:middle;margin-bottom: 3px;" alt=""/> '+F.responseText);setTimeout(function(){$submit.attr("disabled",false).fadeTo("slow",1);B("#error").hide()},3000)},success:function(G){B("#loading").slideUp();comm_array.push(B("#comment").val());B("textarea").each(function(){this.value=""});var K=addComment,L=K.I("cancel-comment-reply-link"),J=K.I("wp-temp-form-div"),F=K.I(K.respondId),H=K.I("comment_post_ID").value,I=K.I("comment_parent").value;if(!edit&&$comments.length){n=parseInt($comments.text().match(/\d+/));$comments.text($comments.text().replace(n,n+1))}new_htm='" id="new_comm_'+num+'"></';new_htm=(I=="0")?('\n<div style="clear:both;" class="commentlist'+new_htm+"div>"):('\n<ul class="children'+new_htm+"ul>");ok_htm='\n<span id="success_'+num+txt3;if(edit_mode=="1"){div_=(document.body.innerHTML.indexOf("div-comment-")==-1)?"":((document.body.innerHTML.indexOf("li-comment-")==-1)?"div-":"");ok_htm=ok_htm.concat(edt1,div_,"comment-",I,'", "',I,'", "respond", "',H,'", ',num,edt2)}ok_htm+="</span><span></span>\n";B("#respond").before(new_htm);B("#new_comm_"+num).hide().append(G);B("#new_comm_"+num+" li").append(ok_htm);B("#new_comm_"+num).show(500);$body.animate({scrollTop:B("#new_comm_"+num).offset().top-200},900);D();num++;edit="";B("*").remove("#edit_id");L.style.display="none";L.onclick=null;K.I("comment_parent").value="0";if(J&&F){J.parentNode.insertAfter(F,J);J.parentNode.removeChild(J)}}});return false});addComment={moveForm:function(G,L,M,J,Q){var H=this,P,K=H.I(G),O=H.I(M),F=H.I("cancel-comment-reply-link"),I=H.I("comment_parent"),N=H.I("comment_post_ID");if(edit){A()}Q?(H.I("comment").value=comm_array[Q],edit=H.I("new_comm_"+Q).innerHTML.match(/(comment-)(\d+)/)[2],$new_sucs=B("#success_"+Q),$new_sucs.hide(),$new_comm=B("#new_comm_"+Q),$new_comm.hide(),$cancel.text(cancel_edit)):$cancel.text(cancel_text);H.respondId=M;J=J||false;if(!H.I("wp-temp-form-div")){P=document.createElement("div");P.id="wp-temp-form-div";P.style.display="none";O.parentNode.insertAfter(P,O)}!K?(temp=H.I("wp-temp-form-div"),H.I("comment_parent").value="0",temp.parentNode.insertAfter(O,temp),temp.parentNode.removeChild(temp)):K.parentNode.insertAfter(O,K.nextSibling);$body.animate({scrollTop:B("#respond").offset().top-180},400);if(N&&J){N.value=J}I.value=L;F.style.display="";F.onclick=function(){if(edit){A()}var T=addComment,U=T.I("wp-temp-form-div"),S=T.I(T.respondId);T.I("comment_parent").value="0";if(U&&S){U.parentNode.insertAfter(S,U);U.parentNode.removeChild(U)}this.style.display="none";this.onclick=null;return false};try{H.I("comment").focus()}catch(R){}return false},I:function(F){return document.getElementById(F)}};function A(){$new_comm.show();$new_sucs.show();B("textarea").each(function(){this.value=""});edit=""}var C=15,E=$submit.val();function D(){if(C>0){$submit.val(C);C--;setTimeout(D,1000)}else{$submit.val(E).attr("disabled",false).fadeTo("slow",1);C=15}}});